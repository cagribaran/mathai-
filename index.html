<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f0c29">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MathAI">
  <meta name="description" content="Yapay zeka ile matematik soruları çöz">
  
  <title>MathAI - Matematik Soruları Çöz</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="icon-192.png">
  
  <!-- React & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    #root {
      width: 100%;
      min-height: 100vh;
    }
    
    /* PWA Install Prompt */
    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: linear-gradient(135deg, #5842ff, #7c3aed);
      color: white;
      padding: 1rem;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(88, 66, 255, 0.4);
      display: flex;
      align-items: center;
      gap: 1rem;
      z-index: 10000;
      animation: slideInUp 0.5s ease;
    }
    
    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .install-prompt-content {
      flex: 1;
    }
    
    .install-prompt h3 {
      margin: 0 0 0.25rem 0;
      font-size: 1rem;
      font-weight: 700;
    }
    
    .install-prompt p {
      margin: 0;
      font-size: 0.85rem;
      opacity: 0.9;
    }
    
    .install-prompt-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .install-btn, .dismiss-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .install-btn {
      background: white;
      color: #5842ff;
    }
    
    .install-btn:active {
      transform: scale(0.95);
    }
    
    .dismiss-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .dismiss-btn:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="install-prompt"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Calculator, Zap, History, Trash2, Copy, Check } = lucide;

    function MathSolver() {
      const [question, setQuestion] = useState('');
      const [solution, setSolution] = useState(null);
      const [loading, setLoading] = useState(false);
      const [history, setHistory] = useState([]);
      const [showHistory, setShowHistory] = useState(false);
      const [copied, setCopied] = useState(false);

      useEffect(() => {
        const saved = localStorage.getItem('mathHistory');
        if (saved) {
          setHistory(JSON.parse(saved));
        }
      }, []);

      const solveMath = async () => {
        if (!question.trim()) return;

        setLoading(true);
        setSolution(null);

        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 1000,
              messages: [
                {
                  role: 'user',
                  content: `Aşağıdaki matematik sorusunu adım adım çöz. Her adımı açıkla ve son cevabı net bir şekilde belirt:

${question}

Çözümü şu formatta sun:
1. İlk önce soruyu analiz et
2. Her adımı numara ile göster
3. Her adımda ne yaptığını açıkla
4. Son cevabı "CEVAP:" başlığı altında ver`
                }
              ]
            })
          });

          const data = await response.json();
          const solutionText = data.content
            .map(item => item.type === 'text' ? item.text : '')
            .filter(Boolean)
            .join('\n');

          const newEntry = {
            id: Date.now(),
            question,
            solution: solutionText,
            timestamp: new Date().toLocaleString('tr-TR')
          };

          setSolution(solutionText);
          
          const updatedHistory = [newEntry, ...history].slice(0, 20);
          setHistory(updatedHistory);
          localStorage.setItem('mathHistory', JSON.stringify(updatedHistory));
        } catch (error) {
          setSolution('❌ Çözüm sırasında bir hata oluştu. Lütfen tekrar dene.');
        } finally {
          setLoading(false);
        }
      };

      const clearHistory = () => {
        setHistory([]);
        localStorage.removeItem('mathHistory');
      };

      const loadFromHistory = (item) => {
        setQuestion(item.question);
        setSolution(item.solution);
        setShowHistory(false);
      };

      const copySolution = () => {
        if (solution) {
          navigator.clipboard.writeText(solution);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        }
      };

      const exampleQuestions = [
        '3x + 5 = 20 denklemini çöz',
        '∫(2x + 3)dx integralini hesapla',
        'f(x) = x² - 4x + 3 fonksiyonunun türevini al',
        '15 ve 25\'in EBOB ve EKOK\'unu bul',
        'Bir üçgenin kenarları 3, 4, 5 ise alanı nedir?'
      ];

      return (
        <div className="math-solver">
          <div className="geometric-bg">
            <div className="geo-pattern"></div>
          </div>

          <div className="container">
            <header className="header">
              <div className="logo-section">
                <Calculator className="logo-icon" size={32} />
                <h1>MathAI</h1>
              </div>
              <p className="tagline">Yapay zeka ile matematik soruları çöz</p>
            </header>

            <div className="main-content">
              <div className="input-section">
                <textarea
                  className="question-input"
                  placeholder="Matematik sorunuzu buraya yazın..."
                  value={question}
                  onChange={(e) => setQuestion(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                      solveMath();
                    }
                  }}
                />
                
                <div className="action-bar">
                  <button 
                    className="solve-btn"
                    onClick={solveMath}
                    disabled={loading || !question.trim()}
                  >
                    {loading ? (
                      <>
                        <div className="spinner"></div>
                        Çözülüyor...
                      </>
                    ) : (
                      <>
                        <Zap size={18} />
                        Çöz
                      </>
                    )}
                  </button>

                  <button 
                    className="history-btn"
                    onClick={() => setShowHistory(!showHistory)}
                  >
                    <History size={18} />
                    Geçmiş
                  </button>
                </div>

                <div className="examples">
                  <p className="examples-title">Örnek sorular:</p>
                  <div className="examples-grid">
                    {exampleQuestions.map((ex, i) => (
                      <button
                        key={i}
                        className="example-btn"
                        onClick={() => setQuestion(ex)}
                      >
                        {ex}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {solution && (
                <div className="solution-section">
                  <div className="solution-header">
                    <h2>Çözüm</h2>
                    <button 
                      className="copy-btn"
                      onClick={copySolution}
                      title="Çözümü kopyala"
                    >
                      {copied ? <Check size={18} /> : <Copy size={18} />}
                      {copied ? 'Kopyalandı!' : 'Kopyala'}
                    </button>
                  </div>
                  <div className="solution-content">
                    {solution.split('\n').map((line, i) => (
                      <p key={i} className="solution-line">{line}</p>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {showHistory && (
              <div className="history-modal">
                <div className="history-content">
                  <div className="history-header">
                    <h2>Geçmiş Çözümler</h2>
                    <div className="history-actions">
                      <button onClick={clearHistory} className="clear-btn">
                        <Trash2 size={18} />
                        Temizle
                      </button>
                      <button onClick={() => setShowHistory(false)} className="close-btn">
                        ✕
                      </button>
                    </div>
                  </div>
                  
                  <div className="history-list">
                    {history.length === 0 ? (
                      <p className="empty-history">Henüz geçmiş yok</p>
                    ) : (
                      history.map(item => (
                        <div 
                          key={item.id} 
                          className="history-item"
                          onClick={() => loadFromHistory(item)}
                        >
                          <p className="history-question">{item.question}</p>
                          <p className="history-time">{item.timestamp}</p>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>

          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Manrope:wght@400;500;600;700;800&display=swap');

            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }

            .math-solver {
              min-height: 100vh;
              background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
              font-family: 'Manrope', sans-serif;
              color: #fff;
              position: relative;
              overflow-x: hidden;
            }

            .geometric-bg {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              opacity: 0.1;
              pointer-events: none;
              z-index: 0;
            }

            .geo-pattern {
              width: 100%;
              height: 100%;
              background-image: 
                linear-gradient(30deg, transparent 45%, rgba(88, 66, 255, 0.3) 45%, rgba(88, 66, 255, 0.3) 55%, transparent 55%),
                linear-gradient(150deg, transparent 45%, rgba(255, 107, 237, 0.3) 45%, rgba(255, 107, 237, 0.3) 55%, transparent 55%),
                linear-gradient(90deg, transparent 45%, rgba(0, 255, 255, 0.3) 45%, rgba(0, 255, 255, 0.3) 55%, transparent 55%);
              background-size: 100px 100px, 100px 100px, 100px 100px;
              background-position: 0 0, 50px 50px, 25px 75px;
              animation: geoMove 20s linear infinite;
            }

            @keyframes geoMove {
              0% { transform: translate(0, 0); }
              100% { transform: translate(100px, 100px); }
            }

            .container {
              max-width: 1000px;
              margin: 0 auto;
              padding: 3rem 2rem;
              position: relative;
              z-index: 1;
            }

            .header {
              text-align: center;
              margin-bottom: 3rem;
              animation: fadeInDown 0.8s ease;
            }

            @keyframes fadeInDown {
              from {
                opacity: 0;
                transform: translateY(-30px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }

            .logo-section {
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 1rem;
              margin-bottom: 0.5rem;
            }

            .logo-icon {
              color: #5842ff;
              filter: drop-shadow(0 0 10px rgba(88, 66, 255, 0.5));
            }

            .header h1 {
              font-size: 3rem;
              font-weight: 800;
              background: linear-gradient(135deg, #5842ff, #ff6bed);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              letter-spacing: -1px;
            }

            .tagline {
              font-size: 1.1rem;
              color: rgba(255, 255, 255, 0.7);
              font-weight: 500;
            }

            .main-content {
              display: flex;
              flex-direction: column;
              gap: 2rem;
            }

            .input-section {
              background: rgba(255, 255, 255, 0.05);
              backdrop-filter: blur(20px);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 24px;
              padding: 2rem;
              box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              animation: fadeInUp 0.8s ease 0.2s both;
            }

            @keyframes fadeInUp {
              from {
                opacity: 0;
                transform: translateY(30px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }

            .question-input {
              width: 100%;
              min-height: 150px;
              background: rgba(0, 0, 0, 0.3);
              border: 2px solid rgba(88, 66, 255, 0.3);
              border-radius: 16px;
              padding: 1.5rem;
              color: #fff;
              font-family: 'JetBrains Mono', monospace;
              font-size: 1rem;
              resize: vertical;
              transition: all 0.3s ease;
            }

            .question-input:focus {
              outline: none;
              border-color: #5842ff;
              box-shadow: 0 0 0 4px rgba(88, 66, 255, 0.2);
            }

            .question-input::placeholder {
              color: rgba(255, 255, 255, 0.4);
            }

            .action-bar {
              display: flex;
              gap: 1rem;
              margin-top: 1.5rem;
            }

            .solve-btn {
              flex: 1;
              background: linear-gradient(135deg, #5842ff, #7c3aed);
              color: white;
              border: none;
              border-radius: 12px;
              padding: 1rem 2rem;
              font-size: 1.1rem;
              font-weight: 700;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 0.5rem;
              transition: all 0.3s ease;
              font-family: 'Manrope', sans-serif;
            }

            .solve-btn:hover:not(:disabled) {
              transform: translateY(-2px);
              box-shadow: 0 10px 30px rgba(88, 66, 255, 0.4);
            }

            .solve-btn:active:not(:disabled) {
              transform: translateY(0);
            }

            .solve-btn:disabled {
              opacity: 0.5;
              cursor: not-allowed;
            }

            .history-btn {
              background: rgba(255, 255, 255, 0.1);
              color: white;
              border: 1px solid rgba(255, 255, 255, 0.2);
              border-radius: 12px;
              padding: 1rem 1.5rem;
              font-size: 1rem;
              font-weight: 600;
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 0.5rem;
              transition: all 0.3s ease;
              font-family: 'Manrope', sans-serif;
            }

            .history-btn:hover {
              background: rgba(255, 255, 255, 0.15);
              transform: translateY(-2px);
            }

            .history-btn:active {
              transform: translateY(0);
            }

            .spinner {
              width: 18px;
              height: 18px;
              border: 3px solid rgba(255, 255, 255, 0.3);
              border-top-color: white;
              border-radius: 50%;
              animation: spin 0.8s linear infinite;
            }

            @keyframes spin {
              to { transform: rotate(360deg); }
            }

            .examples {
              margin-top: 2rem;
              padding-top: 2rem;
              border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .examples-title {
              font-size: 0.9rem;
              color: rgba(255, 255, 255, 0.6);
              margin-bottom: 1rem;
              font-weight: 600;
            }

            .examples-grid {
              display: flex;
              flex-wrap: wrap;
              gap: 0.75rem;
            }

            .example-btn {
              background: rgba(88, 66, 255, 0.15);
              border: 1px solid rgba(88, 66, 255, 0.3);
              color: rgba(255, 255, 255, 0.9);
              padding: 0.5rem 1rem;
              border-radius: 8px;
              font-size: 0.85rem;
              cursor: pointer;
              transition: all 0.3s ease;
              font-family: 'JetBrains Mono', monospace;
            }

            .example-btn:hover {
              background: rgba(88, 66, 255, 0.3);
              border-color: #5842ff;
              transform: translateY(-2px);
            }

            .example-btn:active {
              transform: translateY(0);
            }

            .solution-section {
              background: rgba(255, 255, 255, 0.05);
              backdrop-filter: blur(20px);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 24px;
              padding: 2rem;
              box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              animation: fadeInUp 0.8s ease 0.4s both;
            }

            .solution-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1.5rem;
              padding-bottom: 1rem;
              border-bottom: 2px solid rgba(88, 66, 255, 0.3);
            }

            .solution-header h2 {
              font-size: 1.5rem;
              font-weight: 700;
              color: #5842ff;
            }

            .copy-btn {
              background: rgba(88, 66, 255, 0.2);
              border: 1px solid rgba(88, 66, 255, 0.4);
              color: white;
              padding: 0.5rem 1rem;
              border-radius: 8px;
              font-size: 0.9rem;
              font-weight: 600;
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 0.5rem;
              transition: all 0.3s ease;
              font-family: 'Manrope', sans-serif;
            }

            .copy-btn:hover {
              background: rgba(88, 66, 255, 0.3);
              transform: translateY(-2px);
            }

            .copy-btn:active {
              transform: translateY(0);
            }

            .solution-content {
              background: rgba(0, 0, 0, 0.3);
              border-radius: 16px;
              padding: 1.5rem;
              font-family: 'JetBrains Mono', monospace;
              line-height: 1.8;
            }

            .solution-line {
              margin-bottom: 0.75rem;
              color: rgba(255, 255, 255, 0.9);
            }

            .solution-line:last-child {
              margin-bottom: 0;
            }

            .history-modal {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.7);
              backdrop-filter: blur(10px);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 1000;
              animation: fadeIn 0.3s ease;
              padding: 2rem;
            }

            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }

            .history-content {
              background: rgba(15, 12, 41, 0.95);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 24px;
              max-width: 600px;
              width: 100%;
              max-height: 80vh;
              display: flex;
              flex-direction: column;
              animation: slideUp 0.4s ease;
            }

            @keyframes slideUp {
              from {
                opacity: 0;
                transform: translateY(50px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }

            .history-header {
              padding: 2rem;
              border-bottom: 1px solid rgba(255, 255, 255, 0.1);
              display: flex;
              justify-content: space-between;
              align-items: center;
            }

            .history-header h2 {
              font-size: 1.5rem;
              font-weight: 700;
              color: #5842ff;
            }

            .history-actions {
              display: flex;
              gap: 1rem;
            }

            .clear-btn {
              background: rgba(255, 59, 59, 0.2);
              border: 1px solid rgba(255, 59, 59, 0.4);
              color: white;
              padding: 0.5rem 1rem;
              border-radius: 8px;
              font-size: 0.9rem;
              font-weight: 600;
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 0.5rem;
              transition: all 0.3s ease;
              font-family: 'Manrope', sans-serif;
            }

            .clear-btn:hover {
              background: rgba(255, 59, 59, 0.3);
            }

            .clear-btn:active {
              transform: scale(0.95);
            }

            .close-btn {
              background: rgba(255, 255, 255, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.2);
              color: white;
              width: 36px;
              height: 36px;
              border-radius: 8px;
              font-size: 1.2rem;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.3s ease;
            }

            .close-btn:hover {
              background: rgba(255, 255, 255, 0.15);
            }

            .close-btn:active {
              transform: scale(0.95);
            }

            .history-list {
              overflow-y: auto;
              padding: 1.5rem;
            }

            .empty-history {
              text-align: center;
              color: rgba(255, 255, 255, 0.5);
              padding: 3rem;
              font-size: 1.1rem;
            }

            .history-item {
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 12px;
              padding: 1.25rem;
              margin-bottom: 1rem;
              cursor: pointer;
              transition: all 0.3s ease;
            }

            .history-item:hover {
              background: rgba(88, 66, 255, 0.1);
              border-color: rgba(88, 66, 255, 0.3);
              transform: translateX(5px);
            }

            .history-item:active {
              transform: translateX(3px);
            }

            .history-question {
              color: white;
              font-weight: 600;
              margin-bottom: 0.5rem;
              font-family: 'JetBrains Mono', monospace;
              font-size: 0.95rem;
            }

            .history-time {
              color: rgba(255, 255, 255, 0.5);
              font-size: 0.85rem;
            }

            @media (max-width: 768px) {
              .container {
                padding: 2rem 1rem;
              }

              .header h1 {
                font-size: 2rem;
              }

              .input-section, .solution-section {
                padding: 1.5rem;
              }

              .action-bar {
                flex-direction: column;
              }

              .examples-grid {
                flex-direction: column;
              }

              .example-btn {
                width: 100%;
              }
            }
          `}</style>
        </div>
      );
    }

    // PWA Install Prompt Component
    function InstallPrompt() {
      const [deferredPrompt, setDeferredPrompt] = React.useState(null);
      const [showPrompt, setShowPrompt] = React.useState(false);

      React.useEffect(() => {
        const handler = (e) => {
          e.preventDefault();
          setDeferredPrompt(e);
          setShowPrompt(true);
        };

        window.addEventListener('beforeinstallprompt', handler);

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
          setShowPrompt(false);
        }

        return () => window.removeEventListener('beforeinstallprompt', handler);
      }, []);

      const handleInstall = async () => {
        if (!deferredPrompt) return;

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === 'accepted') {
          setShowPrompt(false);
        }
        
        setDeferredPrompt(null);
      };

      const handleDismiss = () => {
        setShowPrompt(false);
        localStorage.setItem('installPromptDismissed', 'true');
      };

      if (!showPrompt || localStorage.getItem('installPromptDismissed')) {
        return null;
      }

      return (
        <div className="install-prompt">
          <div className="install-prompt-content">
            <h3>Ana Ekrana Ekle</h3>
            <p>Uygulama olarak kullan, daha hızlı erişim</p>
          </div>
          <div className="install-prompt-actions">
            <button className="install-btn" onClick={handleInstall}>
              Ekle
            </button>
            <button className="dismiss-btn" onClick={handleDismiss}>
              ✕
            </button>
          </div>
        </div>
      );
    }

    // Render App
    function App() {
      return (
        <>
          <MathSolver />
          <InstallPrompt />
        </>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
    lucide.createIcons();
  </script>

  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('Service Worker kayıtlı', reg))
          .catch(err => console.log('Service Worker hatası', err));
      });
    }
  </script>
</body>
</html>